<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/reset.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">

    <title>TODO List</title>
</head>
<body>
    <div class="wrapper">
        <header class="header">
            <div class="container">
                <div class="header__inner">
                    <img class="header__logo" src="assets/logo.png" alt="logo">
                    <h1 class="header__title">#MySweetTodoApp</h1>
                </div>
            </div>
        </header>
        
        <main class="main">
            <div class="container">
                <div class="main__inner">
                    <img class="main__decoration" src="assets/decoration.png" onerror="this.style.visibility = 'hidden'">
                    <details class="details main__category" id="category-0">
                        <summary class="summary main__category-title">
                            <div>
                                <img class="summary__icon" src="assets/dir_icon.svg" onerror="this.style.visibility = 'hidden'">
                                <span class="main__category-name">Productivity</span>
                            </div>
                            <hr class="summary__hr">
                            <span class="details__counter" id="counter"></span>
                        </summary>
                        <ul class="list">
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox">
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Work on the landing page</span>
                                </label>
                            </li>
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox">
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Buy food</span>
                                </label>
                            </li>
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox" checked>
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">design a banner</span>
                                </label>
                            </li>
                            <li class="list__item" id="task-input">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox" disabled="disabled">
                                    <span class="checkbox__custom"></span>
                                    <input class="input" id="category-input-0" type="text" placeholder="Write a task..." autocomplete="off">
                                </label>
                            </li>
                        </ul>
                    </details>
                    <details class="details main__category" id="category-1">
                        <summary class="summary main__category-title">
                            <div>
                                <img class="summary__icon" src="assets/dir_icon.svg" onerror="this.style.visibility = 'hidden'">
                                <span class="main__category-name">Assignments</span>
                            </div>
                            <hr class="summary__hr">
                            <span class="details__counter" id="counter"></span>
                        </summary>
                        <ul class="list">
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox">
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Est eu imperdiet tristique viverra neque diam penatibus.</span>
                                </label>
                            </li>
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox">
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Wst eu ue ds.</span>
                                </label>
                            </li>
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox">
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Wst eu ue ds2.</span>
                                </label>
                            </li>
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox">
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Wst eu ue ds3.</span>
                                </label>
                            </li>
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox">
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Wst eu ue ds4.</span>
                                </label>
                            </li>
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox">
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Wst eu ue ds4.</span>
                                </label>
                            </li>
                            <li class="list__item" id="task-input">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox" disabled="disabled">
                                    <span class="checkbox__custom"></span>
                                    <input class="input" id="category-input-1" type="text" placeholder="Write a task..." autocomplete="off">
                                </label>
                            </li>
                        </ul>
                    </details>
                    <details class="details main__category" id="category-2">
                        <summary class="summary main__category-title">
                            <div>
                                <img class="summary__icon" src="assets/dir_icon.svg" onerror="this.style.visibility = 'hidden'">
                                <span class="main__category-name">Work</span>
                            </div>
                            <hr class="summary__hr">
                            <span class="details__counter" id="counter"></span>
                        </summary>
                        <ul class="list">
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox" checked>
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Est eu imperdiet tristique viverra neque diam penatibus.</span>
                                </label>
                            </li>
                            <li class="list__item" id="task">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox">
                                    <span class="checkbox__custom"></span>
                                    <span class="checkbox__text">Wst eu ue ds.</span>
                                </label>
                            </li>
                            <li class="list__item" id="task-input">
                                <label class="checkbox">
                                    <input class="checkbox__input" type="checkbox" disabled="disabled">
                                    <span class="checkbox__custom"></span>
                                    <input class="input" id="category-input-2" type="text" placeholder="Write a task..." autocomplete="off">
                                </label>
                            </li>
                        </ul>
                    </details>
                </div>
                <div class="main__footer">
                    <input class="input" id="category-add-input" type="text" placeholder="Write a category name..." autocomplete="off">
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <div class="footer__inner">
                    <p>Created by tidjekey</p>
                    <p>GitHub: <a href="https://github.com/tidjekey">github.com/tidjekey</a></p>
                </div>
            </div>
        </footer>
    </div>
</body>

    <script>

        const generateRandomId = () => {
           return (new Date()).getTime();
       }
       
        const countTasksInCategory = (categoryId) => {
           console.log('yeas');
           const category = document.querySelector(`#category-${categoryId}`)
           console.log(`#category-${categoryId}`);
           let counter = category.querySelectorAll('#task').length
           console.log(category);
           console.log(counter);
           category.querySelector('#counter').textContent = counter;
       }
       
        const countTasks = () => {
           let lists = document.querySelectorAll('details');
       
           lists.forEach((el) => {
               let counter = el.querySelectorAll('li').length - 1
               el.querySelector('#counter').textContent = counter;
           })
       }
       
        const addNewTask = (categoryId, taskText, isChecked) => {
           const taskPattern = `
               <li class="list__item" id="task">
                   <label class="checkbox">
                       <input class="checkbox__input" type="checkbox" ${isChecked ? "checked" : ""}>
                       <span class="checkbox__custom"></span>
                       <span class="checkbox__text">${taskText}</span>
                   </label>
               </li>
           `
       
           document.querySelector(`#category-${categoryId}`).querySelector('#task-input')
               .insertAdjacentHTML('beforebegin', taskPattern)
       }
       
        const addNewCategory = (categoryName) => {
           let id = generateRandomId()
           const categoryPattern = `
               <details class="details main__category" id="category-${id}">
                   <summary class="summary main__category-title">
                       <div>
                           <img class="summary__icon" src="assets/dir_icon.svg" onerror="this.style.visibility = 'hidden'">
                           <span class="main__category-name">${categoryName}</span>
                       </div>
                       <hr class="summary__hr">
                       <span class="details__counter" id="counter"></span>
                   </summary>
                   <ul class="list">
                       
                       <li class="list__item" id="task-input">
                           <label class="checkbox">
                               <input class="checkbox__input" type="checkbox" disabled="disabled">
                               <span class="checkbox__custom"></span>
                               <input class="input" id="category-input-${id}" type="text" placeholder="Write a task..." autocomplete="off">
                           </label>
                       </li>
                   </ul>
               </details>
           `
       
           document.querySelector(`.main__inner`).insertAdjacentHTML('beforeend', categoryPattern)
           return id
       }
       
        const saveCategories = () => {
           let categories = []
       
           document.querySelectorAll('.details').forEach((el) => {
               let category = {}
               category.categoryId = el.id.replace(/^\D+/g, '')
               category.categoryName = el.querySelector('.main__category-name').textContent
               category.tasks = []
       
               el.querySelectorAll('.list__item').forEach((item) => {
                   if (item.id == 'task-input') return;
                   category.tasks.push({
                       task: item.querySelector('.checkbox__text').textContent,
                       isChecked: item.querySelector('.checkbox__input').checked ? true : false
                   })
               })
               categories.push(category)
           })
           localStorage.setItem('categories', JSON.stringify(categories))
       }
       
        const loadCategories = () => {
           document.querySelectorAll('.details').forEach(e => e.remove());
       
           let categories = JSON.parse(localStorage.getItem('categories'))
       
           categories.forEach((el) => {
       
               const categoryPattern = `
               <details class="details main__category" id="category-${el.categoryId}">
                   <summary class="summary main__category-title">
                       <div>
                           <img class="summary__icon" src="assets/dir_icon.svg" onerror="this.style.visibility = 'hidden'">
                           <span class="main__category-name">${el.categoryName}</span>
                       </div>
                       <hr class="summary__hr">
                       <span class="details__counter" id="counter"></span>
                   </summary>
                   <ul class="list">
                       ${el.tasks.map((task) => {
                           return `
                                   <li class="list__item">
                                       <label class="checkbox">
                                           <input class="checkbox__input" type="checkbox" ${task.isChecked ? "checked" : ""}>
                                           <span class="checkbox__custom"></span>
                                           <span class="checkbox__text">${task.task}</span>
                                       </label>
                                   </li>`
                       }).join('')}
                       <li class="list__item" id="task-input">
                           <label class="checkbox">
                               <input class="checkbox__input" type="checkbox" disabled="disabled">
                               <span class="checkbox__custom"></span>
                               <input class="input" id="category-input-${el.categoryId}" type="text" placeholder="Write a task..." autocomplete="off">
                           </label>
                       </li>
                   </ul>
               </details>`
       
               document.querySelector('.main__inner').insertAdjacentHTML('beforeend', categoryPattern)
           })
       }
       
       
       if (localStorage.getItem('categories') === null) {
           saveCategories()
       }
       
       const mainInner = document.querySelector('.main__inner')
       
       mainInner.addEventListener('click', (e) => {
           let targetClass = e.target.classList
       
           if (targetClass.contains('checkbox__input') || targetClass.contains('checkbox__custom')) {
               saveCategories()
           }
       })
       
       mainInner.addEventListener('keypress', async (e) => {
           let categoryId = await e.target.id.replace(/^\D+/g, '')
           let input = document.querySelector(`#category-input-${categoryId}`)
           let taskName = await input.value
       
           if (e.key === 'Enter' && taskName != '') {
               addNewTask(categoryId, taskName, false)
               countTasksInCategory(categoryId)
               input.value = ''
               saveCategories()
               console.log('yes');
           }
       });
       
       document.querySelector('#category-add-input').addEventListener('keypress', async (e) => {
           let categoryNameInput = document.querySelector('#category-add-input')
           let categoryName = categoryNameInput.value
       
           if (e.key === 'Enter' && categoryName != '') {
               let categoryId = addNewCategory(categoryName)
               countTasksInCategory(categoryId)
               categoryNameInput.value = ''
               saveCategories()
           }
       })
       
       loadCategories()
       countTasks()</script>

</html>

<!--

                    <div class="main__category">
                        <div class="main__category-title">
                            <img src="assets/dir_icon.svg" onerror="this.style.visibility = 'hidden'">
                            <span class="main__category-name">category-1</span>
                        </div>
                        <ul class="list">
                            <li class="list__item">
                                <input class="checkbox" type="checkbox" id="item-checkbox-1">
                                <label for="item-checkbox-1"> wash the dishes 2</label>
                            </li>
                            <li class="list__item">
                                <input class="checkbox" type="checkbox" id="item-checkbox-2">
                                <label for="item-checkbox-2"> wash the dishes 2</label>
                            </li>
                            <li class="list__item">
                                <input class="checkbox" type="checkbox" disabled="disabled">
                                <input type="text" placeholder="Write a task...">
                            </li>
                        </ul>
                    </div>

-->